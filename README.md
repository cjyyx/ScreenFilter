# 屏幕滤镜(类DC)

## 应用简介

对于 OLED 屏幕的手机，一般情况下，屏幕亮度越低，频闪越强。本应用控制屏幕具有较高的亮度，并通过给屏幕添加一层不透明度可调的黑色滤镜来调节实际亮度，从而实现低亮度下也有低频闪的效果。同时，当环境光照较高时，应用会自动关闭屏幕滤镜并打开系统自动亮度，从而使屏幕能够达到最大激发亮度。

本应用在开发时没有考虑兼容性，目前只能保证在我的手机上正常运行。我的手机系统是 MIUI14.

本应用参考了开源项目 https://www.coolapk.com/apk/com.omarea.filter

## 软件使用逻辑

### 主界面

打开软件，打开准备界面（提示提供相应权限）

软件主界面，有

- 屏幕滤镜开关（支持状态栏快捷设置）
- 智能亮度开关（支持状态栏快捷设置）（关闭系统自动亮度，自己实现智能亮度）
- 屏幕亮度设置拖动条（与系统状态栏亮度条同步）
- 最低硬件亮度拖动条（最低硬件亮度应设置为手机屏幕关闭类 DC 调光的阈值）
- 最高滤镜不透明度拖动条，可以调整夜间全黑环境下最舒适的屏幕亮度
- 高光照阈值拖动条（光照达到阈值，打开系统自动亮度，使屏幕能够达到最大激发亮度）
- 亮度-光照曲线设置界面开关

### 光照控制亮度逻辑

通过亮度-光照曲线来实现。点击主界面的亮度-光照曲线设置按钮，打开亮度-光照曲线设置界面。可以通过增减修改光照-亮度对应点来调整亮度-光照曲线。

智能亮度逻辑通过有限状态机实现。有光照平稳、光照突增、光照突减、超高光照、用户调整这几种状态。

光照平稳、光照突增、光照突减：根据亮度-光照曲线设置屏幕亮度 #TODO

高光照：打开系统自动亮度，使屏幕达到最大激发亮度

用户调整：在用户锁屏之前，或一定时间内，以用户调整的亮度为准 #TODO


## 项目依赖

androidplot 库, https://github.com/halfhp/androidplot

可以直接用 Android Studio 打开项目。开发时使用的是 2022.2.1 版。

## 项目架构

### GlobalStatus

使项目各模块解耦合。当一个模块要调用另一个模块的方法时，必须通过 GlobalStatus。

### UI

与应用 UI 有关的模块位于 ui 文件夹下。

### FilterViewManager

应用的核心模块，负责管理屏幕滤镜。

### AppAccessibilityService

无障碍服务，用户启用无障碍功能时被创建

### BrightnessManager

实现光照控制亮度逻辑

光照-亮度对应点 (光照强度{[0,+inf] lux}, 屏幕亮度{[0,1]})

### QuickSetting

与状态栏磁贴服务有关的模块位于 quicksetting 文件夹下